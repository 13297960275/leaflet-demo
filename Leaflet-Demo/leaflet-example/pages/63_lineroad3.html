
<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>Leaflet地图</title><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,layer,haoutil,echarts-forleaflet,leaflet-src,esri-leaflet"></script><link href="css/style.css" rel="stylesheet"></head><body><div id="map" class="map"></div><script>var map;function initMap(){var e=haoutil.system.getRequestByName("config","config/gcj.json");L.src.createMap({id:"map",url:e,success:function(e,t){map=e,initWork()}})}function initWork(){workEcharts.create(map),workEcharts.activate()}$(document).ready(function(){initMap()});var workEcharts={layerWork:null,create:function(e){this.map=e,this.path=""},activate:function(){map.setView([31.872396,117.290191],12),map.changeBaseMap(1),this.queryServer()},disable:function(){map.changeBaseMap(0),null!=this.layerWork&&map.removeLayer(this.layerWork),this.layerWork=null},queryServer:function(){var e=L.esri.query({url:"http://arc.marsgis.cn/arcgis/rest/services/mars/hefei/MapServer/33"}),a=this;e.run(function(e,t,r){null!=e&&0<e.code?haoutil.alert(e.message,"服务访问出错"):null!=t&&null!=t&&0!=t.features.length?a.showQueryResult(t):haoutil.msg("未找到符合查询条件的要素！")})},showQueryResult:function(e){var t=[];for(i=0;i<e.features.length;i++){var r=e.features[i];if(null!=r&&null!=r.geometry&&null!=r.geometry.coordinates&&0!=r.geometry.coordinates.length){var a=1/r.geometry.coordinates.length;t.push({coords:r.geometry.coordinates,lineStyle:{normal:{color:echarts.color.modifyHSL("#5A94DF",Math.round(a*i))}}})}}this.showData(t)},showData:function(e){var t=this.getOption(e);null==this.layerWork?this.layerWork=L.flowEcharts(t).addTo(map):(this.layerWork._echartsOption=t,this.layerWork.redraw())},getOption:function(e){return{backgroundColor:"rgba(17, 19, 42, 0.7)",animation:!0,geo:{map:"",roam:!0},series:[{type:"lines",coordinateSystem:"geo",polyline:!0,data:e,silent:!0,lineStyle:{normal:{opacity:.2,width:1}},progressiveThreshold:500,progressive:200},{type:"lines",coordinateSystem:"geo",polyline:!0,data:e,lineStyle:{normal:{width:0}},effect:{constantSpeed:20,show:!0,trailLength:.1,symbolSize:1.5},zlevel:1}]}}}</script></body></html>