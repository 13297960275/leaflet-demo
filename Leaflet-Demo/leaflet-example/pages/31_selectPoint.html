<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title> Leaflet地图</title><link href="css/style.css" rel="stylesheet"><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,font-awesome,bootstrap,layer,haoutil,leaflet-src,esri-leaflet"></script><style>.yybz_atable{width:100%;border-collapse:collapse;font-size:12px}.yybz_atable td{padding:3px 0;white-space:nowrap}</style></head><body><div id="map" class="map"></div><div class="infoview"><div style="width:100%;text-align:center;font-size:16px">坐标拾取</div><table class="yybz_atable"><tr><td>经度：</td><td><input id="point_jd" type="text" placeholder="单击地图选取" style="width:130px" class="form-control"></td></tr><tr><td>纬度：</td><td><input id="point_wd" type="text" placeholder="单击地图选取" style="width:130px" class="form-control"></td></tr><tr><td colspan="2" style="width:100%;text-align:center"><input id="btnOK" type="button" value="确定" onclick="selectSite()" class="btn btn-primary btn-sm"></td></tr></table></div><script>var map;function initMap(){var a=haoutil.system.getRequestByName("config","config/gcj.json");L.src.createMap({id:"map",url:a,success:function(a,t){map=a,initWork()}})}function initWork(){var a=0,t=0,e=haoutil.system.getRequest();if(e&&"false"==e.view&&$("#info").hide(),e&&e.x&&e.y){180<(a=Number(e.x))&&(a%=180),90<(t=Number(e.y))&&(t%=90),$("#point_jd").val(a),$("#point_wd").val(t);var n=map.convert2map([t,a]);t=n[0],a=n[1],0<t&&0<a&&map.centerAt([t,a])}"false"==e.edit?($("#btnOK").hide(),$("#point_jd").attr("disabled","disabled"),$("#point_wd").attr("disabled","disabled"),0<t&&0<a?(marker=L.marker([t,a]),map.addLayer(marker)):haoutil.msg("没有坐标信息")):($("#point_jd").bind("input propertychange",updateJwd2Map),$("#point_wd").bind("input propertychange",updateJwd2Map),$("#btnOK").show(),map.on("click",mouseClickHandler),$(".leaflet-container").css("cursor","crosshair"),marker=0<t&&0<a?L.marker([t,a]):L.marker([0,0]),map.addLayer(marker))}function updateJwd2Map(){var a=$("#point_jd").val(),t=$("#point_wd").val(),e=map.convert2map([t,a]);marker.setLatLng(e),map.centerAt(e)}function mouseClickHandler(a){marker.setLatLng(a.latlng);var t=map.convert2wgs(a.latlng);$("#point_jd").val(t[1].toFixed(6)),$("#point_wd").val(t[0].toFixed(6))}function selectSite(){var a=$("#point_jd").val(),t=$("#point_wd").val();parent&&parent.updatePointLatlng?parent.updatePointLatlng(a,t):haoutil.msg("您选取了坐标：经度："+a+"纬度："+t)}$(document).ready(function(){initMap()})</script></body></html>