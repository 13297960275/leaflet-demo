<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="author" content=""><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title> Leaflet地图</title><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,font-awesome,bootstrap,layer,haoutil,leaflet-src,esri-leaflet,turf"></script><link href="css/style.css" rel="stylesheet"></head><body><div id="map" class="map"></div><div class="infoview">缓冲半径： <input id="txtRadius" type="number" value="1" min="1" step="1" max="999" class="form-control" style="width:100px">（公里） <input type="button" class="btn btn-primary" value="点" onclick="drawPoint()"> <input type="button" class="btn btn-primary" value="线" onclick="drawPolyline()"> <input type="button" class="btn btn-primary" value="面" onclick="drawPolygon()"></div><script>var map,workDraw,layerBuffer,lastgeojson;function initMap(){var e=haoutil.system.getRequestByName("config","config/gcj.json");L.src.createMap({id:"map",url:e,success:function(e,r){map=e,initWork()}})}function initWork(){workDraw=new L.src.Draw({map:map,isOnly:!0,onCreate:function(e){updateBuffer(e.layer)},onChange:function(e){updateBuffer(e.layer)}}),$("#txtRadius").change(function(e){lastgeojson&&updateBuffer()})}function deleteAll(){workDraw.clearDraw(),layerBuffer&&(map.removeLayer(layerBuffer),layerBuffer=null),lastgeojson=null}function drawPoint(){deleteAll(),workDraw.startDraw("marker")}function drawPolyline(){deleteAll(),workDraw.startDraw("polyline",{style:{color:"#0000ff"}})}function drawPolygon(){deleteAll(),workDraw.startDraw("polygon",{style:{color:"#0000ff"}})}function updateBuffer(e){layerBuffer&&(map.removeLayer(layerBuffer),layerBuffer=null);var r,a=Number($("#txtRadius").val());try{var o=e?e.toGeoJSON():lastgeojson;o.properties={},r=turf.buffer(o,a,{units:"kilometers"}),lastgeojson=o}catch(e){}r&&((layerBuffer=L.geoJSON(r,{style:function(e){return{color:"#ff0000"}}}).getLayers()[0]).addTo(map),layerBuffer.bringToBack())}$(document).ready(function(){initMap()})</script></body></html>