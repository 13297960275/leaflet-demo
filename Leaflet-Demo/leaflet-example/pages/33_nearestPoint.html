
<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="author" content=" "><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>Leaflet地图</title><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,font-awesome,bootstrap,layer,haoutil,leaflet-src,esri-leaflet,turf"></script><link href="css/style.css" rel="stylesheet"></head><body><div id="map" class="map"></div><script>var map,airportBlueIcon,airportRedIcon,nearestQueryResultLayer,layerResult;function initMap(){var e=haoutil.system.getRequestByName("config","config/gcj.json");L.src.createMap({id:"map",url:e,success:function(e,r){map=e,initWork()}})}function initWork(){var e=L.Icon.extend({options:{iconSize:[25,25],iconAnchor:[10,10],popupAnchor:[2,-10]}});airportBlueIcon=new e({iconUrl:"./img/marker/airportBlue.png"}),airportRedIcon=new e({iconUrl:"./img/marker/airportRed.png"}),haoutil.loading.show(),$.getJSON("../data/geojson/airport.json",function(e){haoutil.loading.hide(),nearestQueryResultLayer=L.geoJSON(e,{pointToLayer:function(e,r){return L.marker(r,{icon:airportBlueIcon}).bindPopup(e.properties.NAME)}}).addTo(map),map.fitBounds(nearestQueryResultLayer.getBounds())}),layerResult=L.layerGroup().addTo(map),map.on("click",mapOnClickListener)}$(document).ready(function(){initMap()});var bounds=L.latLngBounds(L.latLng(90,180),L.latLng(-90,-180));function mapOnClickListener(e){if(bounds.contains(e.latlng))if(0!==nearestQueryResultLayer.getLayers().length){layerResult.clearLayers();var r=L.marker(e.latlng).bindPopup("查询点").addTo(layerResult).toGeoJSON(),o=nearestQueryResultLayer.toGeoJSON(),n=turf.nearestPoint(r,o),a=L.geoJSON(n,{pointToLayer:function(e,r){return L.marker(r,{icon:airportRedIcon}).bindPopup("离该点最近的机场为:"+e.properties.NAME)}}).getLayers()[0];a.addTo(layerResult).openPopup(),L.polyline([a.getLatLng(),e.latlng],{color:"red",dashArray:"5, 10"}).addTo(layerResult)}else haoutil.msg("正在加载数据,请稍等......");else haoutil.msg("超出分析范围")}</script></body></html>