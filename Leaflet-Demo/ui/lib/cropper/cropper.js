
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.$)}(this,function(D){"use strict";D="default"in D?D.default:D;var o={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},h=/^data:.*,/,t="undefined"!=typeof window?window.navigator:null,l=t&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(t.userAgent),g=String.fromCharCode;function x(t){return"number"==typeof t&&!isNaN(t)}function n(t){return void 0===t}function r(r,h){for(var t=arguments.length,s=Array(2<t?t-2:0),e=2;e<t;e++)s[e-2]=arguments[e];return function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return r.apply(h,s.concat((a=e,n=[],x(o)&&n.push(o),n.slice.apply(a,n))));var a,o,n}}function k(t){var e=[];return D.each(t,function(t){e.push(t)}),e}function s(t){var e=t.match(/^(https?:)\/\/([^:/?#]+):?(\d*)/i);return e&&(e[1]!==location.protocol||e[2]!==location.hostname||e[3]!==location.port)}function d(t){var e="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+e}function c(t){return t?' crossOrigin="'+t+'"':""}function u(t){var e=[],i=t.translateX,a=t.translateY,o=t.rotate,n=t.scaleX,r=t.scaleY;return x(i)&&0!==i&&e.push("translateX("+i+"px)"),x(a)&&0!==a&&e.push("translateY("+a+"px)"),x(o)&&0!==o&&e.push("rotate("+o+"deg)"),x(n)&&1!==n&&e.push("scaleX("+n+")"),x(r)&&1!==r&&e.push("scaleY("+r+")"),e.length?e.join(" "):"none"}function b(t,e){var i=Math.abs(t.degree)%180,a=(90<i?180-i:i)*Math.PI/180,o=Math.sin(a),n=Math.cos(a),r=t.width,h=t.height,s=t.aspectRatio,d=void 0,c=void 0;return e?c=(d=r/(n+o/s))/s:(d=r*n+h*o,c=r*o+h*n),{width:d,height:c}}function T(t,e){var i=D("<canvas>")[0],a=i.getContext("2d"),o=0,n=0,r=e.naturalWidth,h=e.naturalHeight,s=e.rotate,d=e.scaleX,c=e.scaleY,p=x(d)&&x(c)&&(1!==d||1!==c),l=x(s)&&0!==s,g=l||p,m=r*Math.abs(d||1),f=h*Math.abs(c||1),u=void 0,v=void 0,w=void 0;return p&&(u=m/2,v=f/2),l&&(u=(m=(w=b({width:m,height:f,degree:s})).width)/2,v=(f=w.height)/2),i.width=m,i.height=f,g&&(o=-r/2,n=-h/2,a.save(),a.translate(u,v)),l&&a.rotate(s*Math.PI/180),p&&a.scale(d,c),a.drawImage(t,Math.floor(o),Math.floor(n),Math.floor(r),Math.floor(h)),g&&a.restore(),i}function p(t){var e=new DataView(t),i=e.byteLength,a=void 0,o=void 0,n=void 0,r=void 0,h=void 0,s=void 0,d=void 0,c=void 0,p=void 0;if(255===e.getUint8(0)&&216===e.getUint8(1))for(c=2;c<i;){if(255===e.getUint8(c)&&225===e.getUint8(c+1)){s=c;break}c++}if(s&&(o=s+10,"Exif"===function(t,e,i){var a="",o=void 0;for(i+=o=e;o<i;o++)a+=g(t.getUint8(o));return a}(e,s+4,4)&&((r=18761===(h=e.getUint16(o)))||19789===h)&&42===e.getUint16(o+2,r)&&8<=(n=e.getUint32(o+4,r))&&(d=o+n)),d)for(i=e.getUint16(d,r),p=0;p<i;p++)if(c=d+12*p+2,274===e.getUint16(c,r)){c+=8,a=e.getUint16(c,r),l&&e.setUint16(c,1,r);break}return a}var e={render:function(){var t=this;t.initContainer(),t.initCanvas(),t.initCropBox(),t.renderCanvas(),t.cropped&&t.renderCropBox()},initContainer:function(){var t=this,e=t.options,i=t.$element,a=t.$container,o=t.$cropper,n="cropper-hidden";o.addClass(n),i.removeClass(n),o.css(t.container={width:Math.max(a.width(),Number(e.minContainerWidth)||200),height:Math.max(a.height(),Number(e.minContainerHeight)||100)}),i.addClass(n),o.removeClass(n)},initCanvas:function(){var t=this,e=t.options.viewMode,i=t.container,a=i.width,o=i.height,n=t.image,r=n.naturalWidth,h=n.naturalHeight,s=90===Math.abs(n.rotate),d=s?h:r,c=s?r:h,p=d/c,l=a,g=o;a<o*p?3===e?l=o*p:g=a/p:3===e?g=a/p:l=o*p;var m={naturalWidth:d,naturalHeight:c,aspectRatio:p,width:l,height:g};m.oldLeft=m.left=(a-l)/2,m.oldTop=m.top=(o-g)/2,t.canvas=m,t.limited=1===e||2===e,t.limitCanvas(!0,!0),t.initialImage=D.extend({},n),t.initialCanvas=D.extend({},m)},limitCanvas:function(t,e){var i=this,a=i.options,o=a.viewMode,n=i.container,r=n.width,h=n.height,s=i.canvas,d=s.aspectRatio,c=i.cropBox,p=i.cropped&&c;if(t){var l=Number(a.minCanvasWidth)||0,g=Number(a.minCanvasHeight)||0;o&&(1<o?(l=Math.max(l,r),g=Math.max(g,h),3===o&&(l<g*d?l=g*d:g=l/d)):l?l=Math.max(l,p?c.width:0):g?g=Math.max(g,p?c.height:0):p&&((l=c.width)<(g=c.height)*d?l=g*d:g=l/d)),l&&g?l<g*d?g=l/d:l=g*d:l?g=l/d:g&&(l=g*d),s.minWidth=l,s.minHeight=g,s.maxWidth=1/0,s.maxHeight=1/0}if(e)if(o){var m=r-s.width,f=h-s.height;s.minLeft=Math.min(0,m),s.minTop=Math.min(0,f),s.maxLeft=Math.max(0,m),s.maxTop=Math.max(0,f),p&&i.limited&&(s.minLeft=Math.min(c.left,c.left+c.width-s.width),s.minTop=Math.min(c.top,c.top+c.height-s.height),s.maxLeft=c.left,s.maxTop=c.top,2===o&&(s.width>=r&&(s.minLeft=Math.min(0,m),s.maxLeft=Math.max(0,m)),s.height>=h&&(s.minTop=Math.min(0,f),s.maxTop=Math.max(0,f))))}else s.minLeft=-s.width,s.minTop=-s.height,s.maxLeft=r,s.maxTop=h},renderCanvas:function(t){var e=this,i=e.canvas,a=e.image,o=a.rotate,n=a.naturalWidth,r=a.naturalHeight;if(e.rotated){e.rotated=!1;var h=b({width:a.width,height:a.height,degree:o}),s=h.width/h.height,d=1===a.aspectRatio;if(d||s!==i.aspectRatio){if(i.left-=(h.width-i.width)/2,i.top-=(h.height-i.height)/2,i.width=h.width,i.height=h.height,i.aspectRatio=s,i.naturalWidth=n,i.naturalHeight=r,d&&o%90||o%180){var c=b({width:n,height:r,degree:o});i.naturalWidth=c.width,i.naturalHeight=c.height}e.limitCanvas(!0,!1)}}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),e.limitCanvas(!1,!0),i.oldLeft=i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.oldTop=i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),e.$canvas.css({width:i.width,height:i.height,transform:u({translateX:i.left,translateY:i.top})}),e.renderImage(),e.cropped&&e.limited&&e.limitCropBox(!0,!0),t&&e.output()},renderImage:function(t){var e=this.canvas,i=this.image,a=void 0;i.rotate&&(a=b({width:e.width,height:e.height,degree:i.rotate,aspectRatio:i.aspectRatio},!0)),D.extend(i,a?{width:a.width,height:a.height,left:(e.width-a.width)/2,top:(e.height-a.height)/2}:{width:e.width,height:e.height,left:0,top:0}),this.$clone.css({width:i.width,height:i.height,transform:u(D.extend({translateX:i.left,translateY:i.top},i))}),t&&this.output()},initCropBox:function(){var t=this,e=t.options,i=t.canvas,a=e.aspectRatio,o=Number(e.autoCropArea)||.8,n={width:i.width,height:i.height};a&&(i.height*a>i.width?n.height=n.width/a:n.width=n.height*a),t.cropBox=n,t.limitCropBox(!0,!0),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),n.width=Math.max(n.minWidth,n.width*o),n.height=Math.max(n.minHeight,n.height*o),n.oldLeft=n.left=i.left+(i.width-n.width)/2,n.oldTop=n.top=i.top+(i.height-n.height)/2,t.initialCropBox=D.extend({},n)},limitCropBox:function(t,e){var i=this,a=i.options,o=a.aspectRatio,n=i.container,r=n.width,h=n.height,s=i.canvas,d=i.cropBox,c=i.limited;if(t){var p=Number(a.minCropBoxWidth)||0,l=Number(a.minCropBoxHeight)||0,g=Math.min(r,c?s.width:r),m=Math.min(h,c?s.height:h);p=Math.min(p,r),l=Math.min(l,h),o&&(p&&l?p<l*o?l=p/o:p=l*o:p?l=p/o:l&&(p=l*o),g<m*o?m=g/o:g=m*o),d.minWidth=Math.min(p,g),d.minHeight=Math.min(l,m),d.maxWidth=g,d.maxHeight=m}e&&(c?(d.minLeft=Math.max(0,s.left),d.minTop=Math.max(0,s.top),d.maxLeft=Math.min(r,s.left+s.width)-d.width,d.maxTop=Math.min(h,s.top+s.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=r-d.width,d.maxTop=h-d.height))},renderCropBox:function(){var t=this,e=t.options,i=t.container,a=i.width,o=i.height,n=t.cropBox;(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),t.limitCropBox(!1,!0),n.oldLeft=n.left=Math.min(Math.max(n.left,n.minLeft),n.maxLeft),n.oldTop=n.top=Math.min(Math.max(n.top,n.minTop),n.maxTop),e.movable&&e.cropBoxMovable&&t.$face.data("action",n.width===a&&n.height===o?"move":"all"),t.$cropBox.css({width:n.width,height:n.height,transform:u({translateX:n.left,translateY:n.top})}),t.cropped&&t.limited&&t.limitCanvas(!0,!0),t.disabled||t.output()},output:function(){this.preview(),this.completed&&this.trigger("crop",this.getData())}},v="preview",i={initPreview:function(){var t,e=this,a=c(e.crossOrigin),o=a?e.crossOriginUrl:e.url;e.$preview=D(e.options.preview),e.$clone2=t=D("<img "+a+' src="'+o+'">'),e.$viewBox.html(t),e.$preview.each(function(t,e){var i=D(e);i.data(v,{width:i.width(),height:i.height(),html:i.html()}),i.html("<img "+a+' src="'+o+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(t,e){var i=D(e),a=i.data(v);i.css({width:a.width,height:a.height}).html(a.html).removeData(v)})},preview:function(){var t=this,d=t.image,e=t.canvas,i=t.cropBox,c=i.width,p=i.height,l=d.width,g=d.height,m=i.left-e.left-d.left,f=i.top-e.top-d.top;t.cropped&&!t.disabled&&(t.$clone2.css({width:l,height:g,transform:u(D.extend({translateX:-m,translateY:-f},d))}),t.$preview.each(function(t,e){var i=D(e),a=i.data(v),o=a.width,n=a.height,r=o,h=n,s=1;c&&(h=p*(s=o/c)),p&&n<h&&(r=c*(s=n/p),h=n),i.css({width:r,height:h}).find("img").css({width:l*s,height:g*s,transform:u(D.extend({translateX:-m*s,translateY:-f*s},d))})}))}},a="undefined"!=typeof window?window.PointerEvent:null,m=a?"pointerdown":"touchstart mousedown",f=a?"pointermove":"touchmove mousemove",w=a?" pointerup pointercancel":"touchend touchcancel mouseup",y="wheel mousewheel DOMMouseScroll",C="dblclick",M="resize",$="cropstart",B="cropmove",X="cropend",Y="crop",W="zoom",H={bind:function(){var t=this,e=t.options,i=t.$element,a=t.$cropper;D.isFunction(e.cropstart)&&i.on($,e.cropstart),D.isFunction(e.cropmove)&&i.on(B,e.cropmove),D.isFunction(e.cropend)&&i.on(X,e.cropend),D.isFunction(e.crop)&&i.on(Y,e.crop),D.isFunction(e.zoom)&&i.on(W,e.zoom),a.on(m,r(t.cropStart,this)),e.zoomable&&e.zoomOnWheel&&a.on(y,r(t.wheel,this)),e.toggleDragModeOnDblclick&&a.on(C,r(t.dblclick,this)),D(document).on(f,t.onCropMove=r(t.cropMove,this)).on(w,t.onCropEnd=r(t.cropEnd,this)),e.responsive&&D(window).on(M,t.onResize=r(t.resize,this))},unbind:function(){var t=this,e=t.options,i=t.$element,a=t.$cropper;D.isFunction(e.cropstart)&&i.off($,e.cropstart),D.isFunction(e.cropmove)&&i.off(B,e.cropmove),D.isFunction(e.cropend)&&i.off(X,e.cropend),D.isFunction(e.crop)&&i.off(Y,e.crop),D.isFunction(e.zoom)&&i.off(W,e.zoom),a.off(m,t.cropStart),e.zoomable&&e.zoomOnWheel&&a.off(y,t.wheel),e.toggleDragModeOnDblclick&&a.off(C,t.dblclick),D(document).off(f,t.onCropMove).off(w,t.onCropEnd),e.responsive&&D(window).off(M,t.onResize)}},z=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/;function O(t,e){var i=t.pageX,a=t.pageY,o={endX:i,endY:a};return e?o:D.extend({startX:i,startY:a},o)}var R={resize:function(){var t=this,e=t.options,i=t.$container,a=t.container,o=Number(e.minContainerWidth)||200,n=Number(e.minContainerHeight)||100;if(!t.disabled&&a.width!==o&&a.height!==n){var r,h,s=i.width()/a.width;1===s&&i.height()===a.height||(h=r=void 0,e.restore&&(r=t.getCanvasData(),h=t.getCropBoxData()),t.render(),e.restore&&(t.setCanvasData(D.each(r,function(t,e){r[t]=e*s})),t.setCropBoxData(D.each(h,function(t,e){h[t]=e*s}))))}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(this.$dragBox.hasClass("cropper-crop")?"move":"crop")},wheel:function(t){var e=this,i=t.originalEvent||t,a=Number(e.options.wheelZoomRatio)||.1;if(!e.disabled&&(t.preventDefault(),!e.wheeling)){e.wheeling=!0,setTimeout(function(){e.wheeling=!1},50);var o=1;i.deltaY?o=0<i.deltaY?1:-1:i.wheelDelta?o=-i.wheelDelta/120:i.detail&&(o=0<i.detail?1:-1),e.zoom(-o*a,t)}},cropStart:function(t){var e=this;if(!e.disabled){var i=e.options,a=e.pointers,o=t.originalEvent,n=void 0;o&&o.changedTouches?D.each(o.changedTouches,function(t,e){a[e.identifier]=O(e)}):a[o&&o.pointerId||0]=O(o||t),n=1<k(a).length&&i.zoomable&&i.zoomOnTouch?"zoom":D(t.target).data("action"),z.test(n)&&(e.trigger("cropstart",{originalEvent:o,action:n}).isDefaultPrevented()||(t.preventDefault(),e.action=n,e.cropping=!1,"crop"===n&&(e.cropping=!0,e.$dragBox.addClass("cropper-modal"))))}},cropMove:function(t){var e=this,i=e.action;if(!e.disabled&&i){var a=e.pointers,o=t.originalEvent;t.preventDefault(),e.trigger("cropmove",{originalEvent:o,action:i}).isDefaultPrevented()||(o&&o.changedTouches?D.each(o.changedTouches,function(t,e){D.extend(a[e.identifier],O(e,!0))}):D.extend(a[o&&o.pointerId||0],O(o||t,!0)),e.change(t))}},cropEnd:function(t){var e=this;if(!e.disabled){var i=e.action,a=e.pointers,o=t.originalEvent;o&&o.changedTouches?D.each(o.changedTouches,function(t,e){delete a[e.identifier]}):delete a[o&&o.pointerId||0],i&&(t.preventDefault(),k(a).length||(e.action=""),e.cropping&&(e.cropping=!1,e.$dragBox.toggleClass("cropper-modal",e.cropped&&e.options.modal)),e.trigger("cropend",{originalEvent:o,action:i}))}}},L="se",N="sw",I="ne",P="nw";var E={change:function(t){var e=this,i=e.options,a=e.pointers,o=a[k(a)[0]],n=e.container,r=e.canvas,h=e.cropBox,s=e.action,d=i.aspectRatio,c=h.width,p=h.height,l=h.left,g=h.top,m=l+c,f=g+p,u=0,v=0,w=n.width,x=n.height,b=!0,y=void 0;!d&&t.shiftKey&&(d=c&&p?c/p:1),e.limited&&(u=h.minLeft,v=h.minTop,w=u+Math.min(n.width,r.width,r.left+r.width),x=v+Math.min(n.height,r.height,r.top+r.height));var C,M,$,B={x:o.endX-o.startX,y:o.endY-o.startY};switch(d&&(B.X=B.y*d,B.Y=B.x/d),s){case"all":l+=B.x,g+=B.y;break;case"e":if(0<=B.x&&(w<=m||d&&(g<=v||x<=f))){b=!1;break}c+=B.x,d&&(p=c/d,g-=B.Y/2),c<0&&(s="w",c=0);break;case"n":if(B.y<=0&&(g<=v||d&&(l<=u||w<=m))){b=!1;break}p-=B.y,g+=B.y,d&&(c=p*d,l+=B.X/2),p<0&&(s="s",p=0);break;case"w":if(B.x<=0&&(l<=u||d&&(g<=v||x<=f))){b=!1;break}c-=B.x,l+=B.x,d&&(p=c/d,g+=B.Y/2),c<0&&(s="e",c=0);break;case"s":if(0<=B.y&&(x<=f||d&&(l<=u||w<=m))){b=!1;break}p+=B.y,d&&(c=p*d,l-=B.X/2),p<0&&(s="n",p=0);break;case I:if(d){if(B.y<=0&&(g<=v||w<=m)){b=!1;break}p-=B.y,g+=B.y,c=p*d}else 0<=B.x?m<w?c+=B.x:B.y<=0&&g<=v&&(b=!1):c+=B.x,B.y<=0?v<g&&(p-=B.y,g+=B.y):(p-=B.y,g+=B.y);c<0&&p<0?(s=N,c=p=0):c<0?(s=P,c=0):p<0&&(s=L,p=0);break;case P:if(d){if(B.y<=0&&(g<=v||l<=u)){b=!1;break}p-=B.y,g+=B.y,c=p*d,l+=B.X}else B.x<=0?u<l?(c-=B.x,l+=B.x):B.y<=0&&g<=v&&(b=!1):(c-=B.x,l+=B.x),B.y<=0?v<g&&(p-=B.y,g+=B.y):(p-=B.y,g+=B.y);c<0&&p<0?(s=L,c=p=0):c<0?(s=I,c=0):p<0&&(s=N,p=0);break;case N:if(d){if(B.x<=0&&(l<=u||x<=f)){b=!1;break}c-=B.x,l+=B.x,p=c/d}else B.x<=0?u<l?(c-=B.x,l+=B.x):0<=B.y&&x<=f&&(b=!1):(c-=B.x,l+=B.x),0<=B.y?f<x&&(p+=B.y):p+=B.y;c<0&&p<0?(s=I,c=p=0):c<0?(s=L,c=0):p<0&&(s=P,p=0);break;case L:if(d){if(0<=B.x&&(w<=m||x<=f)){b=!1;break}p=(c+=B.x)/d}else 0<=B.x?m<w?c+=B.x:0<=B.y&&x<=f&&(b=!1):c+=B.x,0<=B.y?f<x&&(p+=B.y):p+=B.y;c<0&&p<0?(s=P,c=p=0):c<0?(s=N,c=0):p<0&&(s=I,p=0);break;case"move":e.move(B.x,B.y),b=!1;break;case"zoom":e.zoom((C=a,M=D.extend({},C),$=[],D.each(C,function(t,s){delete M[t],D.each(M,function(t,e){var i=Math.abs(s.startX-e.startX),a=Math.abs(s.startY-e.startY),o=Math.abs(s.endX-e.endX),n=Math.abs(s.endY-e.endY),r=Math.sqrt(i*i+a*a),h=(Math.sqrt(o*o+n*n)-r)/r;$.push(h)})}),$.sort(function(t,e){return Math.abs(t)<Math.abs(e)}),$[0]),t.originalEvent),b=!1;break;case"crop":if(!B.x||!B.y){b=!1;break}y=e.$cropper.offset(),l=o.startX-y.left,g=o.startY-y.top,c=h.minWidth,p=h.minHeight,0<B.x?s=0<B.y?L:I:B.x<0&&(l-=c,s=0<B.y?N:P),B.y<0&&(g-=p),e.cropped||(e.$cropBox.removeClass("cropper-hidden"),e.cropped=!0,e.limited&&e.limitCropBox(!0,!0))}b&&(h.width=c,h.height=p,h.left=l,h.top=g,e.action=s,e.renderCropBox()),D.each(a,function(t,e){e.startX=e.endX,e.startY=e.endY})}},U=function(){function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}}();var A={crop:function(){var t=this;t.ready&&!t.disabled&&(t.cropped||(t.cropped=!0,t.limitCropBox(!0,!0),t.options.modal&&t.$dragBox.addClass("cropper-modal"),t.$cropBox.removeClass("cropper-hidden")),t.setCropBoxData(t.initialCropBox))},reset:function(){var t=this;t.ready&&!t.disabled&&(t.image=D.extend({},t.initialImage),t.canvas=D.extend({},t.initialCanvas),t.cropBox=D.extend({},t.initialCropBox),t.renderCanvas(),t.cropped&&t.renderCropBox())},clear:function(){var t=this;t.cropped&&!t.disabled&&(D.extend(t.cropBox,{left:0,top:0,width:0,height:0}),t.cropped=!1,t.renderCropBox(),t.limitCanvas(!0,!0),t.renderCanvas(),t.$dragBox.removeClass("cropper-modal"),t.$cropBox.addClass("cropper-hidden"))},replace:function(t,e){var i=this;!i.disabled&&t&&(i.isImg&&i.$element.attr("src",t),e?(i.url=t,i.$clone.attr("src",t),i.ready&&i.$preview.find("img").add(i.$clone2).attr("src",t)):(i.isImg&&(i.replaced=!0),i.options.data=null,i.load(t)))},enable:function(){this.ready&&(this.disabled=!1,this.$cropper.removeClass("cropper-disabled"))},disable:function(){this.ready&&(this.disabled=!0,this.$cropper.addClass("cropper-disabled"))},destroy:function(){var t=this,e=t.$element;t.loaded?(t.isImg&&t.replaced&&e.attr("src",t.originalUrl),t.unbuild(),e.removeClass("cropper-hidden")):t.isImg?e.off("load",t.start):t.$clone&&t.$clone.remove(),e.removeData("cropper")},move:function(t,e){var i=this.canvas;this.moveTo(n(t)?t:i.left+Number(t),n(e)?e:i.top+Number(e))},moveTo:function(t,e){var i=this,a=i.canvas,o=!1;n(e)&&(e=t),t=Number(t),e=Number(e),i.ready&&!i.disabled&&i.options.movable&&(x(t)&&(a.left=t,o=!0),x(e)&&(a.top=e,o=!0),o&&i.renderCanvas(!0))},zoom:function(t,e){var i=this.canvas;t=(t=Number(t))<0?1/(1-t):1+t,this.zoomTo(i.width*t/i.naturalWidth,e)},zoomTo:function(t,e){var i,o,n,r,a=this,h=a.options,s=a.pointers,d=a.canvas,c=d.width,p=d.height,l=d.naturalWidth,g=d.naturalHeight;if(0<=(t=Number(t))&&a.ready&&!a.disabled&&h.zoomable){var m=l*t,f=g*t,u=void 0;if(e&&(u=e.originalEvent),a.trigger("zoom",{originalEvent:u,oldRatio:c/l,ratio:m/l}).isDefaultPrevented())return;if(u){var v=a.$cropper.offset(),w=s&&k(s).length?(i=s,r=n=o=0,D.each(i,function(t,e){var i=e.startX,a=e.startY;o+=i,n+=a,r+=1}),{pageX:o/=r,pageY:n/=r}):{pageX:e.pageX||u.pageX||0,pageY:e.pageY||u.pageY||0};d.left-=(m-c)*((w.pageX-v.left-d.left)/c),d.top-=(f-p)*((w.pageY-v.top-d.top)/p)}else d.left-=(m-c)/2,d.top-=(f-p)/2;d.width=m,d.height=f,a.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+Number(t))},rotateTo:function(t){var e=this;x(t=Number(t))&&e.ready&&!e.disabled&&e.options.rotatable&&(e.image.rotate=t%360,e.rotated=!0,e.renderCanvas(!0))},scale:function(t,e){var i=this,a=i.image,o=!1;n(e)&&(e=t),t=Number(t),e=Number(e),i.ready&&!i.disabled&&i.options.scalable&&(x(t)&&(a.scaleX=t,o=!0),x(e)&&(a.scaleY=e,o=!0),o&&i.renderImage(!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,x(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(x(e)?e:1,t)},getData:function(i){var t=this,e=t.options,a=t.image,o=t.canvas,n=t.cropBox,r=void 0,h=void 0;return t.ready&&t.cropped?(h={x:n.left-o.left,y:n.top-o.top,width:n.width,height:n.height},r=a.width/a.naturalWidth,D.each(h,function(t,e){e/=r,h[t]=i?Math.round(e):e})):h={x:0,y:0,width:0,height:0},e.rotatable&&(h.rotate=a.rotate||0),e.scalable&&(h.scaleX=a.scaleX||1,h.scaleY=a.scaleY||1),h},setData:function(t){var e=this,i=e.options,a=e.image,o=e.canvas,n={},r=void 0,h=void 0,s=void 0;D.isFunction(t)&&(t=t.call(e.element)),e.ready&&!e.disabled&&D.isPlainObject(t)&&(i.rotatable&&x(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,e.rotated=r=!0),i.scalable&&(x(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,h=!0),x(t.scaleY)&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,h=!0)),r?e.renderCanvas():h&&e.renderImage(),s=a.width/a.naturalWidth,x(t.x)&&(n.left=t.x*s+o.left),x(t.y)&&(n.top=t.y*s+o.top),x(t.width)&&(n.width=t.width*s),x(t.height)&&(n.height=t.height*s),e.setCropBoxData(n))},getContainerData:function(){return this.ready?this.container:{}},getImageData:function(){return this.loaded?this.image:{}},getCanvasData:function(){var i=this.canvas,a={};return this.ready&&D.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,e){a[e]=i[e]}),a},setCanvasData:function(t){var e=this,i=e.canvas,a=i.aspectRatio;D.isFunction(t)&&(t=t.call(e.$element)),e.ready&&!e.disabled&&D.isPlainObject(t)&&(x(t.left)&&(i.left=t.left),x(t.top)&&(i.top=t.top),x(t.width)?(i.width=t.width,i.height=t.width/a):x(t.height)&&(i.height=t.height,i.width=t.height*a),e.renderCanvas(!0))},getCropBoxData:function(){var t=this.cropBox;return this.ready&&this.cropped?{left:t.left,top:t.top,width:t.width,height:t.height}:{}},setCropBoxData:function(t){var e=this,i=e.cropBox,a=e.options.aspectRatio,o=void 0,n=void 0;D.isFunction(t)&&(t=t.call(e.$element)),e.ready&&e.cropped&&!e.disabled&&D.isPlainObject(t)&&(x(t.left)&&(i.left=t.left),x(t.top)&&(i.top=t.top),x(t.width)&&t.width!==i.width&&(o=!0,i.width=t.width),x(t.height)&&t.height!==i.height&&(n=!0,i.height=t.height),a&&(o?i.height=i.width/a:n&&(i.width=i.height*a)),e.renderCropBox())},getCroppedCanvas:function(t){var e=this;if(!e.ready||!window.HTMLCanvasElement)return null;if(!e.cropped)return T(e.$clone[0],e.image);D.isPlainObject(t)||(t={});var i=e.getData(),a=i.width,o=i.height,n=a/o,r=void 0,h=void 0,s=void 0;D.isPlainObject(t)&&(r=t.width,h=t.height,r?(h=r/n,s=r/a):h&&(r=h*n,s=h/o));var d=Math.floor(r||a),c=Math.floor(h||o),p=D("<canvas>")[0],l=p.getContext("2d");p.width=d,p.height=c,t.fillColor&&(l.fillStyle=t.fillColor,l.fillRect(0,0,d,c));var g,m,f,u,v,w,x,b,y,C,M,$,B,k=(g=T(e.$clone[0],e.image),m=g.width,f=g.height,u=e.canvas,v=[g],w=i.x+u.naturalWidth*(Math.abs(i.scaleX||1)-1)/2,x=i.y+u.naturalHeight*(Math.abs(i.scaleY||1)-1)/2,B=$=M=C=y=b=void 0,w<=-a||m<w?w=b=C=$=0:w<=0?(C=-w,w=0,b=$=Math.min(m,a+w)):w<=m&&(C=0,b=$=Math.min(a,m-w)),b<=0||x<=-o||f<x?x=y=M=B=0:x<=0?(M=-x,x=0,y=B=Math.min(f,o+x)):x<=f&&(M=0,y=B=Math.min(o,f-x)),v.push(Math.floor(w),Math.floor(x),Math.floor(b),Math.floor(y)),s&&(C*=s,M*=s,$*=s,B*=s),0<$&&0<B&&v.push(Math.floor(C),Math.floor(M),Math.floor($),Math.floor(B)),v);return l.drawImage.apply(l,function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(k)),p},setAspectRatio:function(t){var e=this,i=e.options;e.disabled||n(t)||(i.aspectRatio=Math.max(0,t)||NaN,e.ready&&(e.initCropBox(),e.cropped&&e.renderCropBox()))},setDragMode:function(t){var e=this,i=e.options,a=void 0,o=void 0;e.loaded&&!e.disabled&&(a="crop"===t,o=i.movable&&"move"===t,t=a||o?t:"none",e.$dragBox.data("action",t).toggleClass("cropper-crop",a).toggleClass("cropper-move",o),i.cropBoxMovable||e.$face.data("action",t).toggleClass("cropper-crop",a).toggleClass("cropper-move",o))}},j="cropper-hidden",F=/^data:/,q=/^data:image\/jpeg;base64,/,S=function(){function a(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);var i=this;i.$element=D(t),i.options=D.extend({},o,D.isPlainObject(e)&&e),i.loaded=!1,i.ready=!1,i.completed=!1,i.rotated=!1,i.cropped=!1,i.disabled=!1,i.replaced=!1,i.limited=!1,i.wheeling=!1,i.isImg=!1,i.originalUrl="",i.canvas=null,i.cropBox=null,i.pointers={},i.init()}return U(a,[{key:"init",value:function(){var t=this.$element,e=void 0;if(t.is("img")){if(this.isImg=!0,this.originalUrl=e=t.attr("src"),!e)return;e=t.prop("src")}else t.is("canvas")&&window.HTMLCanvasElement&&(e=t[0].toDataURL());this.load(e)}},{key:"trigger",value:function(t,e){var i=D.Event(t,e);return this.$element.trigger(i),i}},{key:"load",value:function(t){var e=this,i=e.options,a=e.$element;if(t)if(e.url=t,e.image={},i.checkOrientation&&ArrayBuffer)if(F.test(t))q.test(t)?e.read(function(t){var e=t.replace(h,""),i=atob(e),a=i.length,o=new ArrayBuffer(a),n=new Uint8Array(o),r=void 0;for(r=0;r<a;r++)n[r]=i.charCodeAt(r);return o}(t)):e.clone();else{var o=new XMLHttpRequest;o.onerror=o.onabort=D.proxy(function(){e.clone()},this),o.onload=function(){e.read(this.response)},i.checkCrossOrigin&&s(t)&&a.prop("crossOrigin")&&(t=d(t)),o.open("get",t),o.responseType="arraybuffer",o.withCredentials="use-credentials"===a.prop("crossOrigin"),o.send()}else e.clone()}},{key:"read",value:function(t){var e=this.options,i=p(t),a=this.image,o=0,n=1,r=1;if(1<i)switch(this.url=function(t){var e=new Uint8Array(t),i=e.length,a="",o=void 0;for(o=0;o<i;o++)a+=g(e[o]);return"data:image/jpeg;base64,"+btoa(a)}(t),i){case 2:n=-1;break;case 3:o=-180;break;case 4:r=-1;break;case 5:o=90,r=-1;break;case 6:o=90;break;case 7:o=90,n=-1;break;case 8:o=-90}e.rotatable&&(a.rotate=o),e.scalable&&(a.scaleX=n,a.scaleY=r),this.clone()}},{key:"clone",value:function(){var t=this,e=t.options,i=t.$element,a=t.url,o="",n=void 0;e.checkCrossOrigin&&s(a)&&((o=i.prop("crossOrigin"))?n=a:(o="anonymous",n=d(a))),t.crossOrigin=o,t.crossOriginUrl=n;var r=D("<img "+c(o)+' src="'+(n||a)+'">');t.$clone=r,t.isImg?i[0].complete?t.start():i.one("load",D.proxy(t.start,this)):r.one("load",D.proxy(t.start,this)).one("error",D.proxy(t.stop,this)).addClass("cropper-hide").insertAfter(i)}},{key:"start",value:function(){var i=this,t=i.$clone,e=i.$element;i.isImg||(t.off("error",i.stop),e=t),function(t,e){if(!t.naturalWidth||l){var i=document.createElement("img");i.onload=function(){e(this.width,this.height)},i.src=t.src}else e(t.naturalWidth,t.naturalHeight)}(e[0],function(t,e){D.extend(i.image,{naturalWidth:t,naturalHeight:e,aspectRatio:t/e}),i.loaded=!0,i.build()})}},{key:"stop",value:function(){this.$clone.remove(),this.$clone=null}},{key:"build",value:function(){var t=this,e=t.options,i=t.$element,a=t.$clone,o=void 0,n=void 0,r=void 0;t.loaded&&(t.ready&&t.unbuild(),t.$container=i.parent(),t.$cropper=o=D('<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>'),t.$canvas=o.find(".cropper-canvas").append(a),t.$dragBox=o.find(".cropper-drag-box"),t.$cropBox=n=o.find(".cropper-crop-box"),t.$viewBox=o.find(".cropper-view-box"),t.$face=r=n.find(".cropper-face"),i.addClass(j).after(o),t.isImg||a.removeClass("cropper-hide"),t.initPreview(),t.bind(),e.aspectRatio=Math.max(0,e.aspectRatio)||NaN,e.viewMode=Math.max(0,Math.min(3,Math.round(e.viewMode)))||0,t.cropped=e.autoCrop,e.autoCrop?e.modal&&t.$dragBox.addClass("cropper-modal"):n.addClass(j),e.guides||n.find(".cropper-dashed").addClass(j),e.center||n.find(".cropper-center").addClass(j),e.cropBoxMovable&&r.addClass("cropper-move").data("action","all"),e.highlight||r.addClass("cropper-invisible"),e.background&&o.addClass("cropper-bg"),e.cropBoxResizable||n.find(".cropper-line, .cropper-point").addClass(j),t.setDragMode(e.dragMode),t.render(),t.ready=!0,t.setData(e.data),t.completing=setTimeout(function(){D.isFunction(e.ready)&&i.one("ready",e.ready),t.trigger("ready"),t.trigger("crop",t.getData()),t.completed=!0},0))}},{key:"unbuild",value:function(){var t=this;t.ready&&(t.completed||clearTimeout(t.completing),t.ready=!1,t.completed=!1,t.initialImage=null,t.initialCanvas=null,t.initialCropBox=null,t.container=null,t.canvas=null,t.cropBox=null,t.unbind(),t.resetPreview(),t.$preview=null,t.$viewBox=null,t.$cropBox=null,t.$dragBox=null,t.$canvas=null,t.$container=null,t.$cropper.remove(),t.$cropper=null)}}],[{key:"setDefaults",value:function(t){D.extend(o,D.isPlainObject(t)&&t)}}]),a}();D.extend(S.prototype,e),D.extend(S.prototype,i),D.extend(S.prototype,H),D.extend(S.prototype,R),D.extend(S.prototype,E),D.extend(S.prototype,A);var K="cropper",Z=D.fn.cropper;D.fn.cropper=function(r){for(var t=arguments.length,h=Array(1<t?t-1:0),e=1;e<t;e++)h[e-1]=arguments[e];var s=void 0;return this.each(function(t,e){var i=D(e),a=i.data(K);if(!a){if(/destroy/.test(r))return;var o=D.extend({},i.data(),D.isPlainObject(r)&&r);i.data(K,a=new S(e,o))}if("string"==typeof r){var n=a[r];D.isFunction(n)&&(s=n.apply(a,h))}}),void 0!==s?s:this},D.fn.cropper.Constructor=S,D.fn.cropper.setDefaults=S.setDefaults,D.fn.cropper.noConflict=function(){return D.fn.cropper=Z,this}});