L.Curve=L.Path.extend({options:{},initialize:function(t,n){L.setOptions(this,n),this._initialUpdate=!0,this._setPath(t)},getPath:function(){return this._coords},setPath:function(t){return this._setPath(t),this.redraw()},getBounds:function(){return this._bounds},_setPath:function(t){this._coords=t,this._bounds=this._computeBounds()},_computeBounds:function(){for(var t,n,e,o=new L.LatLngBounds,i=0;i<this._coords.length;i++)if("string"==typeof(e=this._coords[i])||e instanceof String)n=e;else if("H"==n)o.extend([t.lat,e[0]]),t=new L.latLng(t.lat,e[0]);else if("V"==n)o.extend([e[0],t.lng]),t=new L.latLng(e[0],t.lng);else if("C"==n){var s=new L.latLng(e[0],e[1]);e=this._coords[++i];var a=new L.latLng(e[0],e[1]);e=this._coords[++i];var r=new L.latLng(e[0],e[1]);o.extend(s),o.extend(a),o.extend(r),r.controlPoint1=s,r.controlPoint2=a,t=r}else if("S"==n){a=new L.latLng(e[0],e[1]);e=this._coords[++i];r=new L.latLng(e[0],e[1]),s=t;if(t.controlPoint2){var l=t.lat-t.controlPoint2.lat,h=t.lng-t.controlPoint2.lng;s=new L.latLng(t.lat+l,t.lng+h)}o.extend(s),o.extend(a),o.extend(r),r.controlPoint1=s,r.controlPoint2=a,t=r}else if("Q"==n){var c=new L.latLng(e[0],e[1]);e=this._coords[++i];r=new L.latLng(e[0],e[1]);o.extend(c),o.extend(r),r.controlPoint=c,t=r}else if("T"==n){r=new L.latLng(e[0],e[1]),c=t;if(t.controlPoint){l=t.lat-t.controlPoint.lat,h=t.lng-t.controlPoint.lng;c=new L.latLng(t.lat+l,t.lng+h)}o.extend(c),o.extend(r),r.controlPoint=c,t=r}else o.extend(e),t=new L.latLng(e[0],e[1]);return o},getCenter:function(){return this._bounds.getCenter()},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updatecurve(this)},_project:function(){var t,n,e,o;this._points=[];for(var i=0;i<this._coords.length;i++)if("string"==typeof(t=this._coords[i])||t instanceof String)this._points.push(t),e=t;else{switch(t.length){case 2:o=this._map.latLngToLayerPoint(t),n=t;break;case 1:n="H"==e?(o=this._map.latLngToLayerPoint([n[0],t[0]]),[n[0],t[0]]):(o=this._map.latLngToLayerPoint([t[0],n[1]]),[t[0],n[1]])}this._points.push(o)}}}),L.curve=function(t,n){return new L.Curve(t,n)},L.SVG.include({_updatecurve:function(t){if(this._setPath(t,this._curvePointsToPath(t._points)),t.options.animate){var n=t._path,e=n.getTotalLength();t.options.dashArray||(n.style.strokeDasharray=e+" "+e),t._initialUpdate&&(n.animate([{strokeDashoffset:e},{strokeDashoffset:0}],t.options.animate),t._initialUpdate=!1)}},_curvePointsToPath:function(t){for(var n,e,o="",i=0;i<t.length;i++)if("string"==typeof(n=t[i])||n instanceof String)o+=e=n;else switch(e){case"H":o+=n.x+" ";break;case"V":o+=n.y+" ";break;default:o+=n.x+","+n.y+" "}return o||"M0 0"}});