
<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>Leaflet地图</title><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,layer,haoutil,mapV,leaflet-mars,esri-leaflet"></script><link href="css/style.css" rel="stylesheet"></head><body><div id="map" class="map"></div><script>var map;function initMap(){var a=haoutil.system.getRequestByName("config","config/gcj.json");L.mars.createMap({id:"map",url:a,success:function(a,t){map=a,initWork()}})}function initWork(){workMapV.create(map),workMapV.activate()}$(document).ready(function(){initMap()});var workMapV={layerWork:null,create:function(a){this.map=a,this.path="",this.layerWork=L.featureGroup()},activate:function(){map.changeBaseMap(1),map.addLayer(this.layerWork);var t=this;$.ajax({url:"../data/apidemo/qianxi-time.txt",type:"GET",dataType:"text",success:function(a){t.showMapV(a)}})},disable:function(){map.changeBaseMap(0),map.removeLayer(this.layerWork)},showMapV:function(a){map.setView([36.64,108.15],4);var t=[],l=[];function e(a,t,e){for(var r=(t.lng-a.lng)/e,i=(t.lat-a.lat)/e,n=0;n<e;n++){var o=a.lng+r*n,p=a.lat+i*n;l.push({geometry:{type:"Point",coordinates:[o,p]},count:1,time:n})}}for(var r=a.split("|"),i=0;i<r.length;i++)for(var n=r[i].split(/\n/),o=0;o<n.length;o++)if(n[o]){var p=n[o].split(/\t/);if("起点城市"===p[0]||"迁出城市"===p[0])var s=p[1];if("起点城市"!==p[0]||"迁出城市"!==p[0]&&1<p.length){var m=mapv.utilCityCenter.getCenterByCityName(p[0].replace(/市|省/,"")),c=mapv.utilCityCenter.getCenterByCityName(s.replace(/市|省/,"").trim());m&&(.7<Math.random()&&e(c,m,50),t.push({geometry:{type:"LineString",coordinates:[[m.lng,m.lat],[c.lng,c.lat]]},count:100*Math.random()}))}}var y=new mapv.DataSet(t);L.mapVLayer(y,{strokeStyle:"rgba(55, 50, 250, 0.3)",globalCompositeOperation:"lighter",shadowColor:"rgba(55, 50, 250, 0.5)",methods:{click:function(a){}},gradient:{0:"rgba(55, 50, 250, 0)",1:"rgba(55, 50, 250, 1)"},lineWidth:.2,draw:"intensity"}).addTo(this.layerWork);var g=new mapv.DataSet(l);L.mapVLayer(g,{fillStyle:"rgba(255, 250, 250, 0.9)",size:.5,animation:{type:"time",stepsRange:{start:0,end:50},trails:1,duration:5},draw:"simple"}).addTo(this.layerWork)}}</script></body></html>