
<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>Leaflet地图</title><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,layer,haoutil,echarts-forleaflet,leaflet-src,esri-leaflet"></script><link href="css/style.css" rel="stylesheet"></head><body><div id="map" class="map"></div><script>var map;function initMap(){var e=haoutil.system.getRequestByName("config","config/gcj.json");L.src.createMap({id:"map",url:e,success:function(e,t){map=e,initWork()}})}function initWork(){workEcharts.create(map),workEcharts.activate()}$(document).ready(function(){initMap()});var workEcharts={layerWork:null,_arr_charts:[],configEchars:{DeepUsedLength:{name:"县道",color:"#ff8da3"},DeepUnUsedLength:{name:"国道",color:"#524db9"},UnDeepUsedLength:{name:"高速",color:"#ffc2c2"},UnDeepUnUsedLength:{name:"铁路",color:"#c7c7f9"}},create:function(e){this.map=e,this.path="",this.layerWork=L.featureGroup()},activate:function(){this.map.addLayer(this.layerWork);var t=this;$.getJSON("../data/apidemo/echarspoint.json",function(e){t.showData(e)})},disable:function(){this.clearLayers(),this.map.removeLayer(this.layerWork)},showData:function(e){this.clearLayers();for(var t=0;t<e.length;t++){var a=e[t];a._index=t,0!=a.TotalLength&&this.addmarker(a)}this.map.stop(),this.map.fitBounds(this.layerWork.getBounds())},addmarker:function(t){var e="port_"+t._index,a=9*Math.log(t.TotalLength);200<a&&(a=200),a<60&&(a=60),L.marker([t.Y,t.X],{icon:L.divIcon({className:"",iconSize:[.6*a,.6*a],html:'<div  style="width: '+.6*a+"px; height: "+.6*a+'px; position: relative; background-color: #ffffff;border-radius: 50%;">1</div>'})}).addTo(this.layerWork);L.marker([t.Y,t.X],{icon:L.divIcon({className:"leaflet-echart-icon",iconSize:[a,a],html:'<div id="'+e+'" style="width: '+a+"px; height: "+a+'px; position: relative; background-color: transparent;"></div>'})}).addTo(this.layerWork);var r=.7*a/String(t.TotalLength).length-1,n=echarts.init(document.getElementById(e));this._arr_charts.push(n),option={tooltip:{trigger:"item",formatter:function(e){return e.seriesName+"<br/>"+e.name+"<br/>长度"+e.value+"km<br/>占比"+e.percent.toFixed(0)+"%"}},series:[{name:t.PortName,type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!0,position:"center",formatter:function(e){return t.TotalLength+"\nkm"},textStyle:{fontSize:r,color:"#000000"}},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:t.DeepUsedLength,name:this.configEchars.DeepUsedLength.name},{value:t.DeepUnUsedLength,name:this.configEchars.DeepUnUsedLength.name},{value:t.UnDeepUsedLength,name:this.configEchars.UnDeepUsedLength.name},{value:t.UnDeepUnUsedLength,name:this.configEchars.UnDeepUnUsedLength.name}]}]},n.setOption(option)},updateStyle:function(e){for(var t=0;t<this._arr_charts.length;t++){var a;a=1==e?{series:[{radius:["50%","70%"]}]}:{series:[{radius:["0","70%"]}]},this._arr_charts[t].setOption(a)}},clearLayers:function(){for(var e=0;e<this._arr_charts.length;e++){this._arr_charts[e].dispose()}this._arr_charts=[],this.layerWork.clearLayers()}}</script></body></html>