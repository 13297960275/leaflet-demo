<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>Leaflet地图</title><link href="css/style.css" rel="stylesheet"><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,font-awesome,bootstrap,layer,haoutil,leaflet-mars,esri-leaflet"></script><style>.legend-container{position:fixed;bottom:0;right:0;z-index:5000;padding:10px;border-radius:5px;border:1px solid #bbb;background:rgba(238,240,237,.9)}.legend-title{text-align:center}.legend-item{line-height:28px;margin:3px 0}.legend-color{padding:2px 20px;opacity:.6}.legend-des{margin-left:5px}</style></head><body><div id="map" class="map"></div><script>var map;function initMap(){var e=haoutil.system.getRequestByName("config","config/gcj.json");L.mars.createMap({id:"map",url:e,success:function(e,t){map=e,initWork()}})}function initWork(){workSheng.init(map);workSheng.activate([{name:"辽宁省",Y:41.4859599390001,X:124.049036594,value:6,id:0},{name:"天津市",Y:39.292278417,X:117.337698238,value:1,id:1},{name:"河北省",Y:38.8875371020001,X:115.05608039,value:3,id:2},{name:"山东省",Y:36.3846343380001,X:118.335456608,value:8,id:3},{name:"江苏省",Y:31.9494682210001,X:119.175534669,value:12,id:4},{name:"上海市",Y:31.2051176030001,X:121.507670825,value:1,id:5},{name:"浙江省",Y:29.2499134930001,X:120.438160114,value:7,id:6},{name:"福建省",Y:26.0324798610001,X:118.134283206,value:4,id:7},{name:"广东省",Y:23.69235645,X:113.489506429,value:18,id:8},{name:"广西壮族自治区",Y:23.806009465,X:108.79016159,value:6,id:9},{name:"海南省",Y:19.210592585,X:109.774303805,value:11,id:10},{name:"云南省",Y:24.224322869,X:101.862567546,value:1,id:11},{name:"四川省",Y:30.6273874010001,X:102.694776433,value:2,id:12},{name:"重庆市",Y:30.057271884,X:107.874570298,value:1,id:13},{name:"湖北省",Y:30.975494014,X:112.27112659,value:14,id:14},{name:"湖南省",Y:27.610006298,X:111.708571339,value:2,id:15},{name:"江西省",Y:27.6138173950001,X:115.721821513,value:2,id:16},{name:"安徽省",Y:31.8254596190001,X:117.226379045,value:7,id:17},{name:"黑龙江省",Y:46.951327674,X:128.132064887,value:2,id:18}])}$(document).ready(function(){initMap()});var workSheng={map:null,layerWork:null,selectData:{title:"港口数量",unit:"个",span:[1,5,10,15,20]},init:function(e,t){return this.map=e,t&&(this.selectData=t),this},activate:function(t){var a=this;$.getJSON("../data/geojson/china.json",function(e){a.initData(e,t)})},_visible:!0,visible:function(e){this._visible=e,null!=this.map&&(e?this.map.addLayer(this.layerWork):this.map.removeLayer(this.layerWork))},colors:["#FFEDA0","#FEB24C","#FD8D3C","#FC4E2A","#E31A1C","#BD0026","#800026"],getColor:function(e){var t=this.selectData.span,a=t.length+1;a>this.colors.length&&(a=this.colors.length);for(var i=0;i<a;i++)if(e<t[i])return this.colors[i];return this.colors[a-1]},initData:function(e,t){for(var a=0;a<e.features.length;a++){for(var i=e.features[a],n=i.properties.num=0;n<t.length;n++){var r=i.properties.name;if(-1!=t[n].name.indexOf(r)){i.properties.num=t[n].value;break}}i.properties.color=this.getColor(i.properties.num)}this.addLayer(e)},disable:function(){this.layerWork&&(map.removeLayer(this.layerWork),this.layerWork=null),document.getElementById("legendContainer")&&$("#legendContainer").remove()},addLayer:function(e){this.addLegend();var n=this;null==this.layerWork?(this.layerWork=L.geoJson(e,{style:function(e){return{weight:2,opacity:1,color:"white",fillOpacity:.7,fillColor:e.properties.color}},onEachFeature:function(e,t){var a=e.properties,i=a.name+"<br/>"+n.selectData.title+":"+a.num+n.selectData.unit;t.bindTooltip(i,{className:"jsondatalayer-tooltip",direction:"top"}),t.on({mouseover:function(e){var t=e.target;t.setStyle({weight:3,color:"#666",fillOpacity:.7}),L.Browser.ie||L.Browser.opera||t.bringToFront()},mouseout:function(e){var t=e.target;n.layerWork.resetStyle(t)},click:function(e){map.fitBounds(e.target.getBounds())}})}}),this._visible&&this.map.addLayer(this.layerWork)):(this.layerWork.clearLayers(),this.layerWork.addData(e)),this._visible&&this.map.flyToBounds(this.layerWork.getBounds())},showPolyTip:function(e){for(var t=this.layerWork.getLayers(),a=0;a<t.length;a++){var i=t[a];if(i.feature.properties.name==e){i.setStyle({weight:3,color:"#666",fillOpacity:.7}),i.openTooltip();break}}},hidePolyTip:function(e){for(var t=this.layerWork.getLayers(),a=0;a<t.length;a++){var i=t[a];if(i.feature.properties.name==e){this.layerWork.resetStyle(i),i.closeTooltip();break}}},addLegend:function(){var e=null;e=document.getElementById("legendContainer")?$("#legendContainer"):$('<div id="legendContainer" class="legend-container"></div>').appendTo($(document.body));var t="<div class='legend-title'>"+this.selectData.title+"("+this.selectData.unit+")</div>",a=this.selectData.span,i=this.colors,n=a.length;n>i.length&&(n=i.length);for(var r=0;r<=n;r++){var o=a[r];o=0==r?"小于"+a[r]:r==n?"大于"+a[r-1]:a[r-1]+"-"+a[r],t+="<div class='legend-item'><span class='legend-color' style='background:"+i[r]+"'></span><span class='legend-des'>"+o+"</span></div>"}$(e).html(t)}}</script></body></html>