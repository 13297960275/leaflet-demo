<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title> Leaflet地图</title><link href="css/style.css" rel="stylesheet"><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,font-awesome,bootstrap,layer,haoutil,leaflet-mars,esri-leaflet"></script><style>.gradientTable{width:99%;padding:0;border-spacing:0}.gradientTable th{font:bold 12px "微软雅黑",Verdana,Arial,Helvetica,sans-serif;color:#4f6b72;border-right:1px solid #c1dad7;border-bottom:1px solid #c1dad7;border-top:1px solid #c1dad7;letter-spacing:2px;text-transform:uppercase;text-align:left;padding:6px 6px 6px 12px;background:#cae8ea}.gradientTable th.nobg{border-top:0;border-left:0;border-right:1px solid #c1dad7;background:0 0}.gradientTable td{border-right:1px solid #c1dad7;border-bottom:1px solid #c1dad7;font-size:12px;padding:6px 6px 6px 12px;color:#4f6b72}.gradientTable td.alt{background:#f5fafa;color:#797268}.gradientTable tr:nth-child(odd){background:#fff}.gradientTable tr:nth-child(even){background:#f5fafa}</style></head><body><div id="map" class="map"></div><div class="infoview"><div style="width:100%;text-align:left;height:35px"><button id="btn_plot_savefile" type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-save" aria-hidden="true"></span> 保存</button> <button id="btn_plot_openfile" type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span> 打开</button> <input id="input_plot_file" type="file" accept=".json" style="display:none"> &nbsp; &nbsp; <input id="btnResetDraw" type="button" value="重新绘制" class="btn btn-warning btn-sm"></div><table id="tablePoints" class="gradientTable" cellspacing="0"></table></div><script>var map;function initMap(){var t=haoutil.system.getRequestByName("config","config/gcj.json");L.mars.createMap({id:"map",url:t,success:function(t,e){map=t,initWork()}})}function initWork(){$("#btnResetDraw").click(function(){workDraw.resetDraw()}),plotFile.initEvent();var t,e=haoutil.system.getRequest();t=e&&e.type?e.type:"polygon",workDraw.init(t);workDraw.resetDraw()}$(document).ready(function(){initMap()});var plotFile={initEvent:function(){var a=this;$("#btn_plot_openfile").click(function(){$("#input_plot_file").click()}),$("#btn_plot_savefile").click(function(){var t=workDraw.getGeoJson();""!=t?haoutil.file.downloadFile("我的标注.json",t):haoutil.msg("没有需要保存的数据")}),$("#input_plot_file").change(function(t){var e=this.files[0],i=e.name;if("json"!=i.substring(i.lastIndexOf(".")+1,i.length).toLowerCase())return layer.msg("文件类型不合法,请选择json格式标注文件！"),void a.clearPlotFile();if(window.FileReader){var n=new FileReader;n.readAsText(e,"UTF-8"),n.onloadend=function(t){var e=this.result;workDraw.jsonToLayer(e),a.clearPlotFile()}}})},clearPlotFile:function(){window.addEventListener?document.getElementById("input_plot_file").value="":document.getElementById("input_plot_file").outerHTML+=""}},workDraw={showEdit:!1,type:"",work:null,init:function(t){this.type=t;var i=this,e=new L.mars.Draw({map:map,isOnly:!0,onCreate:function(t){var e=t.layer;i.updateViewForMap(e)},onChange:function(t){var e=i.work.currEditFeature;i.updateViewForMap(e)}});this.work=e,this.showEdit||$("#tablePoints").hide()},resetDraw:function(){this.updateViewForMap(),this.work.startDraw(this.type)},getGeoJson:function(){return this.work.toJson()},jsonToLayer:function(t){this.work.jsonToLayer(t,!0,!0);var e=this.work.getFeatures();this.updateViewForMap(e)},lastLayer:null,updateViewForMap:function(t){if(this.showEdit){var e;e=null==(this.lastLayer=t)?[]:t.getLatLngs()[0];var o="";$("#tablePoints").empty(),o+="<tr>",o+="\t<th style='width:10%' scope='col'></td>",o+="\t<th scope='col'>经度</td>",o+="\t<th scope='col'>纬度</td>",o+="</tr>",$.each(e,function(t,e){var i=map.convert2wgs(e),n=i[1].toFixed(6),a=i[0].toFixed(6);o+="<tr>",o+="\t<td>"+(t+1)+"</td>",o+="\t<td>",o+="\t\t<input name='jwd' type='text' value='"+n+"' style='width: 99%' />",o+="\t</td>",o+="\t<td>",o+="\t\t<input name='jwd' type='text' value='"+a+"' style='width: 99%' />",o+="\t</td>",o+="</tr>"}),$("#tablePoints").append(o);var i=this;$("input[name='jwd']").bind("input propertychange",function(){i.updateMapForView()})}},updateMapForView:function(){if(null!=this.lastLayer){var a=new Array;$("#tablePoints tr").each(function(t){if(0<t){var e=$($(this).find("input")[0]).val(),i=$($(this).find("input")[1]).val(),n=map.convert2map({lat:i,lng:e});a.push(n)}}),this.lastLayer.setLatLngs([a]),this.lastLayer.editing.updateMarkers()}}}</script></body></html>