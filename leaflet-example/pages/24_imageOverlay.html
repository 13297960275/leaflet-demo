<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title> Leaflet地图</title><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,font-awesome,bootstrap,layer,jquery.range,haoutil,leaflet-mars,esri-leaflet"></script><link href="css/style.css" rel="stylesheet"></head><body><div id="map" class="map"></div><div class="infoview"><input id="btnDraw" type="button" class="btn btn-primary" value="重新绘制"> <input id="btnClear" type="button" class="btn btn-primary" value="清除"> <input id="btnSave" type="button" class="btn btn-primary" value="保存"><br>透明度 &nbsp; <label id="lblOpacity">100%</label> <input id="imgOpacity" type="range"></div><script>var map,workDraw;function initMap(){var a=haoutil.system.getRequestByName("config","config/gcj.json");L.mars.createMap({id:"map",url:a,success:function(a,t){map=a,initWork()}})}function initWork(){$("#btnDraw").click(function(){workDraw.startDraw("rectangle",{style:{fill:!0,fillOpacity:.1,color:"#ffffff",weight:1}})}),$("#btnClear").click(function(){workDraw.clearDraw()}),$("#btnSave").click(function(){var a=workDraw.getFeatures();if(!a)return haoutil.msg("当前没有绘制区域!"),"";var t=a.getBounds(),e=t.getSouthWest(),r=t.getNorthEast();e=map.convert2wgs(e),r=map.convert2wgs(r),haoutil.alert(JSON.stringify([e,r]))}),$("#imgOpacity").range({min:0,max:100,step:1,value:100,onChange:function(a,t){$("#lblOpacity").html(t+"%"),updateOpacity(a/100)}}),workDraw=new L.mars.Draw({map:map,isOnly:!0,onCreate:function(a){var t=a.layer,e=Number($("#imgOpacity").val())/10,r=L.imageOverlay("img/simple/gugong.jpg",t.getBounds(),{opacity:e});workDraw.getLayer().addLayer(r),t.imageOverlay=r},onChange:function(a){var t=a.layer;t.imageOverlay.setBounds(t.getBounds())}}),showData({url:"img/simple/gugong.jpg",bounds:[[39.921882,116.396327],[39.911086,116.385148]]})}function showData(a){var t=[map.convert2map(a.bounds[0]),map.convert2map(a.bounds[1])],e=Number($("#imgOpacity").val())/10,r=L.rectangle(t,{color:"#ffffff",weight:1}).addTo(workDraw.getLayer()),n=L.imageOverlay(a.url,t,{opacity:e});workDraw.getLayer().addLayer(n),r.imageOverlay=n,map.fitBounds(t)}function updateOpacity(a){for(var t=workDraw.getLayer().getLayers(),e=0;e<t.length;e++){var r=t[e];r.setOpacity&&r.setOpacity(a)}}$(document).ready(function(){initMap()})</script></body></html>