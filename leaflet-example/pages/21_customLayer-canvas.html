<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1,maximum-scale=1"><meta name="author" content=" "><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><meta name="x5-fullscreen" content="true"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>Leaflet地图</title><script src="../lib/include-lib.js" libpath="../lib/" include="jquery,font-awesome,bootstrap,layer,haoutil,leaflet-src,esri-leaflet"></script><link href="css/style.css" rel="stylesheet"></head><body><div id="map" class="map"></div><script src="../lib/leafletPlugins/_vector/Leaflet.CustomLayer.js"></script><script>var map;function initMap(){var e=haoutil.system.getRequestByName("config","config/gcj.json");L.src.createMap({id:"map",url:e,success:function(e,n){map=e,initWork()}})}function initWork(){map.changeBaseMap(1);for(var a=[],e=1e4;e--;){var n=L.src.util.randomLatLng();a.push(n)}map.fitBounds(a),haoutil.msg("渲染了1万个点");var t=L.customLayer({container:document.createElement("canvas"),padding:.1,zooms:[0,18],opacity:1,visible:!0,zIndex:120,alwaysRender:!0});t.on("layer-beforemount",function(){console.log("layer-beforemount")}),t.on("layer-mounted",function(){console.log("layer-mounted")}),t.on("layer-render",function(){console.log("layer-render");var e=function(){var e=this.getContainer(),n=L.Browser.retina?2:1,t=this._bounds.getSize(),o=this._padding;e.width=n*t.x,e.height=n*t.y,e.style.width=t.x+"px",e.style.height=t.y+"px";var a=e.getContext("2d");return L.Browser.retina&&a.scale(n,n),a.translate(o.x,o.y),a.clearRect(0,0,e.width,e.height),a}.bind(this)();e.fillStyle="rgba(255,116,0, 0.5)";for(var n=map.getBounds(),t=0;t<a.length;t++){var o=a[t];n.contains([o.lat,o.lng])&&(dot=map.latLngToContainerPoint([o.lat,o.lng]),e.beginPath(),e.arc(dot.x,dot.y,3,0,2*Math.PI),e.fill(),e.closePath())}}),t.on("layer-beforedestroy",function(){console.log("layer-beforedestroy")}),t.on("layer-destroyed",function(){console.log("layer-destroyed")}),t.addTo(map)}$(document).ready(function(){initMap()})</script></body></html>