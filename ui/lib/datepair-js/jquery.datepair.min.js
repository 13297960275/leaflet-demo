/* 2018-3-10 12:34:16 | 版权所有 合肥火星科技有限公司 http://www.marsgis.cn  【联系我们QQ：516584683，微信：marsgis】 */
!function(t,s){"use strict";function i(t,e){var i=e||{};for(var s in t)s in i||(i[s]=t[s]);return i}function e(t,e){if(n)n(t).trigger(e);else{var i=s.createEvent("CustomEvent");i.initCustomEvent(e,!0,!0,{}),t.dispatchEvent(i)}}function g(t,e){return n?n(t).hasClass(e):t.classList.contains(e)}function a(t,e){this.dateDelta=null,this.timeDelta=null,this._defaults={startClass:"start",endClass:"end",timeClass:"time",dateClass:"date",defaultDateDelta:0,defaultTimeDelta:36e5,anchor:"start",parseTime:function(t){return n(t).timepicker("getTime")},updateTime:function(t,e){n(t).timepicker("setTime",e)},setMinTime:function(t,e){n(t).timepicker("option","minTime",e)},parseDate:function(t){return t.value&&n(t).datepicker("getDate")},updateDate:function(t,e){n(t).datepicker("update",e)}},this.container=t,this.settings=i(this._defaults,e),this.startDateInput=this.container.querySelector("."+this.settings.startClass+"."+this.settings.dateClass),this.endDateInput=this.container.querySelector("."+this.settings.endClass+"."+this.settings.dateClass),this.startTimeInput=this.container.querySelector("."+this.settings.startClass+"."+this.settings.timeClass),this.endTimeInput=this.container.querySelector("."+this.settings.endClass+"."+this.settings.timeClass),this.refresh(),this._bindChangeHandler()}var u=864e5,n=t.Zepto||t.jQuery;a.prototype={constructor:a,option:function(t,e){if("object"==typeof t)this.settings=i(this.settings,t);else if("string"==typeof t&&void 0!==e)this.settings[t]=e;else if("string"==typeof t)return this.settings[t];this._updateEndMintime()},getTimeDiff:function(){var t=this.dateDelta+this.timeDelta;return!(t<0)||this.startDateInput&&this.endDateInput||(t+=u),t},refresh:function(){if(this.startDateInput&&this.startDateInput.value&&this.endDateInput&&this.endDateInput.value){var t=this.settings.parseDate(this.startDateInput),e=this.settings.parseDate(this.endDateInput);t&&e&&(this.dateDelta=e.getTime()-t.getTime())}if(this.startTimeInput&&this.startTimeInput.value&&this.endTimeInput&&this.endTimeInput.value){var i=this.settings.parseTime(this.startTimeInput),s=this.settings.parseTime(this.endTimeInput);i&&s&&(this.timeDelta=s.getTime()-i.getTime(),this._updateEndMintime())}},remove:function(){this._unbindChangeHandler()},_bindChangeHandler:function(){n?n(this.container).on("change.datepair",n.proxy(this.handleEvent,this)):this.container.addEventListener("change",this,!1)},_unbindChangeHandler:function(){n?n(this.container).off("change.datepair"):this.container.removeEventListener("change",this,!1)},handleEvent:function(t){this._unbindChangeHandler(),g(t.target,this.settings.dateClass)?""!=t.target.value?(this._dateChanged(t.target),this._timeChanged(t.target)):this.dateDelta=null:g(t.target,this.settings.timeClass)&&(""!=t.target.value?this._timeChanged(t.target):this.timeDelta=null),this._validateRanges(),this._updateEndMintime(),this._bindChangeHandler()},_dateChanged:function(t){if(this.startDateInput&&this.endDateInput){var e=this.settings.parseDate(this.startDateInput),i=this.settings.parseDate(this.endDateInput);if(e&&i)if("start"==this.settings.anchor&&g(t,this.settings.startClass)){var s=new Date(e.getTime()+this.dateDelta);this.settings.updateDate(this.endDateInput,s)}else if("end"==this.settings.anchor&&g(t,this.settings.endClass)){s=new Date(i.getTime()-this.dateDelta);this.settings.updateDate(this.startDateInput,s)}else if(i<e){var a=g(t,this.settings.startClass)?this.endDateInput:this.startDateInput,n=this.settings.parseDate(t);this.dateDelta=0,this.settings.updateDate(a,n)}else this.dateDelta=i.getTime()-e.getTime();else if(null!==this.settings.defaultDateDelta){if(e){var h=new Date(e.getTime()+this.settings.defaultDateDelta*u);this.settings.updateDate(this.endDateInput,h)}else if(i){var r=new Date(i.getTime()-this.settings.defaultDateDelta*u);this.settings.updateDate(this.startDateInput,r)}this.dateDelta=this.settings.defaultDateDelta*u}else this.dateDelta=null}},_timeChanged:function(t){if(this.startTimeInput&&this.endTimeInput){var e=this.settings.parseTime(this.startTimeInput),i=this.settings.parseTime(this.endTimeInput);if(e&&i)if("start"==this.settings.anchor&&g(t,this.settings.startClass)){var s=new Date(e.getTime()+this.timeDelta);this.settings.updateTime(this.endTimeInput,s),i=this.settings.parseTime(this.endTimeInput),this._doMidnightRollover(e,i)}else if("end"==this.settings.anchor&&g(t,this.settings.endClass)){s=new Date(i.getTime()-this.timeDelta);this.settings.updateTime(this.startTimeInput,s),e=this.settings.parseTime(this.startTimeInput),this._doMidnightRollover(e,i)}else{var a,n;if(this._doMidnightRollover(e,i),this.startDateInput&&this.endDateInput&&(a=this.settings.parseDate(this.startDateInput),n=this.settings.parseDate(this.endDateInput)),+a==+n&&i<e){var h=g(t,this.settings.endClass)?this.endTimeInput:this.startTimeInput,r=g(t,this.settings.startClass)?this.endTimeInput:this.startTimeInput,u=this.settings.parseTime(h);this.timeDelta=0,this.settings.updateTime(r,u)}else this.timeDelta=i.getTime()-e.getTime()}else if(null!==this.settings.defaultTimeDelta){if(e){var d=new Date(e.getTime()+this.settings.defaultTimeDelta);this.settings.updateTime(this.endTimeInput,d)}else if(i){var l=new Date(i.getTime()-this.settings.defaultTimeDelta);this.settings.updateTime(this.startTimeInput,l)}this.timeDelta=this.settings.defaultTimeDelta}else this.timeDelta=null}},_doMidnightRollover:function(t,e){if(this.startDateInput&&this.endDateInput){var i=this.settings.parseDate(this.endDateInput),s=this.settings.parseDate(this.startDateInput),a=e.getTime()-t.getTime(),n=e<t?u:-1*u;null!==this.dateDelta&&this.dateDelta+this.timeDelta<=u&&this.dateDelta+a!=0&&(0<n||0!=this.dateDelta)&&(0<=a&&this.timeDelta<0||a<0&&0<=this.timeDelta)&&("start"==this.settings.anchor?(this.settings.updateDate(this.endDateInput,new Date(i.getTime()+n)),this._dateChanged(this.endDateInput)):"end"==this.settings.anchor&&(this.settings.updateDate(this.startDateInput,new Date(s.getTime()-n)),this._dateChanged(this.startDateInput))),this.timeDelta=a}},_updateEndMintime:function(){if("function"==typeof this.settings.setMinTime){var t=null;"start"==this.settings.anchor&&(!this.dateDelta||this.dateDelta<u||this.timeDelta&&this.dateDelta+this.timeDelta<u)&&(t=this.settings.parseTime(this.startTimeInput)),this.settings.setMinTime(this.endTimeInput,t)}},_validateRanges:function(){return this.startTimeInput&&this.endTimeInput&&null===this.timeDelta?void e(this.container,"rangeIncomplete"):this.startDateInput&&this.endDateInput&&null===this.dateDelta?void e(this.container,"rangeIncomplete"):void(!this.startDateInput||!this.endDateInput||0<=this.dateDelta+this.timeDelta?e(this.container,"rangeSelected"):e(this.container,"rangeError"))}},t.Datepair=a}(window,document),function(a){a&&(a.fn.datepair=function(i){var s;return this.each(function(){var t=a(this),e=t.data("datepair");e||(e=new Datepair(this,"object"==typeof i&&i),t.data("datepair",e)),"string"==typeof i&&(s=e[i]())}),s||this},a("[data-datepair]").each(function(){var t=a(this);t.datepair(t.data())}))}(window.Zepto||window.jQuery);