var thisWidget,$table,thisLayer,isAdding,arrLayers=[];function initWidgetView(e){thisWidget=e,$("#toolbar").hide(),$table=$("#table"),arrLayers=thisWidget.config.layers;for(var t="",a=0;a<arrLayers.length;a++){t+=' <li><a href="javascript:changeSelectLayer('+a+')">'+arrLayers[a].name+"</a></li>"}$("#featurelayerList").html(t),$("#btnAdd").click(addFeature)}function getHeight(){return $(window).height()-80}function changeSelectLayer(e){thisLayer=arrLayers[e],$("#btnSelect").html("已选:"+thisLayer.name+'<span class="caret"></span>'),$("#toolbar").show(),thisWidget.showLayer(thisLayer)}function refData(e){var t=[];for(var a in e){var i=e[a].feature.properties;t.push(i)}$table.bootstrapTable("load",t)}function showAllFrature(e){for(var t=[],a=thisLayer.columnsShow&&thisLayer.columnsShow.table,i=0;i<thisLayer.columns.length;i++){var r=thisLayer.columns[i];a&&-1==thisLayer.columnsShow.table.indexOf(r.field)||t.push({field:r.field,title:r.name,sortable:!0,editable:!1,align:"left"})}t.push({field:"operate",title:"操作",align:"center",width:50,events:{"click .remove":function(e,t,a,i){thisWidget.deleteFeatures([a.OBJECTID])}},formatter:function(e,t,a){return['<a class="remove" href="javascript:void(0)" title="删除">','<i class="fa fa-trash"></i>',"</a>"].join("")}});var s=[];for(i=0;i<e.length;i++){var l=e[i].feature.properties;s.push(l)}$table.bootstrapTable("destroy"),$table.bootstrapTable({height:getHeight(),singleSelect:!0,pagination:!0,columns:t,data:s,onClickRow:function(e,t,a){thisWidget.centerAt(e.OBJECTID)}})}function addFeature(){if(isAdding=!isAdding){switch(thisLayer.geometrytype){case"point":case"marker":thisWidget.startAdd("marker",thisLayer.symbol);break;case"polyline":thisWidget.startAdd("polyline",thisLayer.symbol);break;case"polygon":thisWidget.startAdd("polygon",thisLayer.symbol)}$("#btnAdd").html("取消新增")}else startEnd()}function startEnd(){isAdding=!1,thisWidget.cacheAdd(),$("#btnAdd").html("新增"),showMsg()}function showMsg(e){$("#lblMsg").html(e||"")}