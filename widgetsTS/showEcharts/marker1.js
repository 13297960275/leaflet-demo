L.widget.bindClass(L.widget.BaseWidget.extend({options:{},layerWork:null,_arr_charts:[],configEchars:{DeepUsedLength:{name:"深水已利用",color:"#ff8da3"},DeepUnUsedLength:{name:"深水未利用",color:"#524db9"},UnDeepUsedLength:{name:"非深水已利用",color:"#ffc2c2"},UnDeepUnUsedLength:{name:"非深水未利用",color:"#c7c7f9"}},create:function(){this.layerWork=L.featureGroup()},activate:function(){this.map.addLayer(this.layerWork);var t=this;$.getJSON("data/apidemo/echarspoint.json",function(e){t.isActivate&&t.showData(e)})},disable:function(){this.clearLayers(),this.map.removeLayer(this.layerWork)},showData:function(e){this.clearLayers();for(var t=0;t<e.length;t++){var a=e[t];a._index=t,0!=a.TotalLength&&this.addmarker(a)}this.map.stop(),this.map.fitBounds(this.layerWork.getBounds())},addmarker:function(t){var e="port_"+t._index,a=9*Math.log(t.TotalLength);200<a&&(a=200),a<60&&(a=60),L.marker([t.Y,t.X],{icon:L.divIcon({className:"",iconSize:[.6*a,.6*a],html:'<div  style="width: '+.6*a+"px; height: "+.6*a+'px; position: relative; background-color: #ffffff;border-radius: 50%;">1</div>'})}).addTo(this.layerWork);L.marker([t.Y,t.X],{icon:L.divIcon({className:"leaflet-echart-icon",iconSize:[a,a],html:'<div id="'+e+'" style="width: '+a+"px; height: "+a+'px; position: relative; background-color: transparent;"></div>'})}).addTo(this.layerWork);var r=.7*a/String(t.TotalLength).length-1,n=echarts.init(document.getElementById(e));this._arr_charts.push(n),option={tooltip:{trigger:"item",formatter:function(e){return e.seriesName+"<br/>"+e.name+"<br/>长度"+e.value+"km<br/>占比"+e.percent.toFixed(0)+"%"}},series:[{name:t.PortName,type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!0,position:"center",formatter:function(e){return t.TotalLength+"\nkm"},textStyle:{fontSize:r,color:"#000000"}},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:[{value:t.DeepUsedLength,name:this.configEchars.DeepUsedLength.name,itemStyle:{normal:{color:this.configEchars.DeepUsedLength.color}}},{value:t.DeepUnUsedLength,name:this.configEchars.DeepUnUsedLength.name,itemStyle:{normal:{color:this.configEchars.DeepUnUsedLength.color}}},{value:t.UnDeepUsedLength,name:this.configEchars.UnDeepUsedLength.name,itemStyle:{normal:{color:this.configEchars.UnDeepUsedLength.color}}},{value:t.UnDeepUnUsedLength,name:this.configEchars.UnDeepUnUsedLength.name,itemStyle:{normal:{color:this.configEchars.UnDeepUnUsedLength.color}}}]}]},n.setOption(option)},updateStyle:function(e){for(var t=0;t<this._arr_charts.length;t++){var a;a=1==e?{series:[{radius:["50%","70%"]}]}:{series:[{radius:["0","70%"]}]},this._arr_charts[t].setOption(a)}},clearLayers:function(){for(var e=0;e<this._arr_charts.length;e++){this._arr_charts[e].dispose()}this._arr_charts=[],this.layerWork.clearLayers()}}));