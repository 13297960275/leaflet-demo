L.Polyline.include({_snaking:!1,_snakingRings:0,_snakingVertices:0,_snakingDistance:0,snakeIn:function(){if(!this._snaking&&"performance"in window&&"now"in window.performance&&this._map)return this._snaking=!0,this._zt_sate=!1,this._snakingTime=performance.now(),this._snakingVertices=this._snakingRings=this._snakingDistance=0,this._snakeLatLngs||(this._snakeLatLngs=L.Polyline._flat(this._latlngs)?[this._latlngs]:this._latlngs),this._latlngs=[[this._snakeLatLngs[0][0],this._snakeLatLngs[0][0]]],this.options.color_defaule=this.options.color,this._update(),this._snake(),this.fire("snakestart"),this},_zt_sate:!1,snakeZT:function(){this._zt_sate=!0},snakeJX:function(){this._zt_sate&&(this._zt_sate=!1,this._snakingTime=performance.now(),this._snake())},snakeOut:function(){this._snakeEnd()},_snake:function(){if(this._snaking&&!this._zt_sate){var s=performance.now(),n=(s-this._snakingTime)*this.options.snakingSpeed/1e3;return this._snakingTime=s,this._latlngs[this._snakingRings].pop(),this._snakeForward(n)}},_snakeForward:function(s){if(this._snaking&&!this._zt_sate){var n=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingRings][this._snakingVertices]),i=this._map.latLngToContainerPoint(this._snakeLatLngs[this._snakingRings][this._snakingVertices+1]),t=n.distanceTo(i);if(this._snakingDistance+s>t){if(this._snakingVertices++,this._latlngs[this._snakingRings].push(this._snakeLatLngs[this._snakingRings][this._snakingVertices]),this._snakingVertices>=this._snakeLatLngs[this._snakingRings].length-1){if(this._snakingRings>=this._snakeLatLngs.length-1)return this._snakeEnd();this._snakingVertices=0,this._snakingRings++,this._latlngs[this._snakingRings]=[this._snakeLatLngs[this._snakingRings][this._snakingVertices]]}return this._snakingDistance-=t,this._snakeForward(s)}this._snakingDistance+=s;var a=this._snakingDistance/t,e=i.multiplyBy(a).add(n.multiplyBy(1-a)),h=this._map.containerPointToLatLng(e);this._latlngs[this._snakingRings].push(h),this.setStyle({color:this.options.color_snake||"#ff0000"}),this.setLatLngs(this._latlngs),this.fire("snake",{latlng:h,point:n,nextPoint:i}),L.Util.requestAnimFrame(this._snake,this)}},_snakeEnd:function(){this._snaking&&(this.setLatLngs(this._snakeLatLngs),this.setStyle({color:this.options.color_defaule}),this._snaking=!1,this._zt_sate=!1,this.fire("snakeend",{latlng:this._snakeLatLngs[this._snakeLatLngs.length-1]}))}}),L.Polyline.mergeOptions({snakingSpeed:300}),L.LayerGroup.include({_snakingLayers:[],_snakingLayersDone:0,_snaking:!1,snakeIn:function(){if("performance"in window&&"now"in window.performance&&this._map&&!this._snaking){this._snaking=!0,this._snakingLayers=[],this._snakingLayersDone=0;var s=Object.keys(this._layers);for(var n in s){var i=s[n];this._snakingLayers.push(this._layers[i])}return this.clearLayers(),this.fire("snakestart"),this._snakeNext()}},snakeOut:function(){this._snaking=!1,this._zt_sate=!1,-1!=this.intervalID&&clearTimeout(this.intervalID);for(var s=0;s<this._snakingLayers.length;s++){var n=this._snakingLayers[s];null!=n&&(n.hasOwnProperty("snakeOut")&&n.snakeOut(),this.addLayer(n))}this.fire("snakeend")},intervalID:-1,_zt_sate:!1,snakeZT:function(){this._zt_sate=!0,-1!=this.intervalID&&clearTimeout(this.intervalID)},snakeJX:function(){this._zt_sate&&(this._zt_sate=!1,this._snakeNext())},getLastLayer:function(){if(this._snakingLayersDone>=this._snakingLayers.length)return this._snakingLayers[this._snakingLayers.length-1];var s=this._snakingLayers[this._snakingLayersDone];return null==s?this._snakingLayers[this._snakingLayers.length-1]:s},_snakeNext:function(){if(!this._zt_sate){if(this._snakingLayersDone>=this._snakingLayers.length)return this.fire("snakeend"),this._snaking=!1,void(this._zt_sate=!1);var s=this._snakingLayers[this._snakingLayersDone];return null==s?(this.fire("snakeend"),this._snaking=!1,void(this._zt_sate=!1)):(this._snakingLayersDone++,this.addLayer(s),"snakeIn"in s?(s.once("snakeend",function(){this._snaking&&(this.intervalID=setTimeout(this._snakeNext.bind(this),this.options.snakingPause))},this),s.snakeIn()):this.intervalID=setTimeout(this._snakeNext.bind(this),this.options.snakingPause),this.fire("snake"),this)}}}),L.LayerGroup.mergeOptions({snakingPause:200});