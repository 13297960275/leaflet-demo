L.ImageCanvasOverlay=L.Path.extend({options:{draggable:!1,fill:!1,stroke:!1},initialize:function(t,i,n){this._url=t,this._image=new Image,this._image.src=this._url,this._bounds=L.latLngBounds(i),L.Util.setOptions(this,n)},setUrl:function(t){return this._url=t,this._image=new Image,this._image.src=this._url,this._map&&this._reset(),this},setBounds:function(t){return this._bounds=L.latLngBounds(t),this._map&&this._reset(),this},getBounds:function(){return this._bounds},_project:function(){this._point_topleft=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._point_bottonright=this._map.latLngToLayerPoint(this._bounds.getSouthEast()),this._updateBounds()},_updateBounds:function(){this._pxBounds=new L.Bounds(this._point_topleft,this._point_bottonright)},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateImageOverlay(this)},_empty:function(){return this._url&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){var i=this._clickTolerance();return t.x<=this._point_bottonright.x+i&&t.x>=this._point_topleft.x-i&&t.y<=this._point_bottonright.y+i&&t.y>=this._point_topleft.y-i},getRgba:function(t){var i,n=this._renderer._ctx,e=this._map.latLngToLayerPoint(t),s=this._renderer._bounds.min;return e.x-=s.x,e.y-=s.y,L.Browser.retina&&(e.x=2*e.x,e.y=2*e.y),i="rgba("+(i=n.getImageData(e.x-1,e.y-1,1,1).data)[0]+","+i[1]+","+i[2]+","+i[3]+")"}}),L.imageCanvasOverlay=function(t,i,n){return new L.ImageCanvasOverlay(t,i,n)},L.Canvas.include({_updateImageOverlay:function(t){if(!t._empty()){var i=t._point_topleft,n=t._point_bottonright,e=this._ctx;this._drawnLayers[t._leaflet_id]=t;var s=n.x-i.x,a=n.y-i.y;e.drawImage(t._image,i.x,i.y,s,a),this._fillStroke(e,t)}}});